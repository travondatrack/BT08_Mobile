<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/myapplication/AzureUploader.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/myapplication/AzureUploader.java" />
              <option name="originalContent" value="package com.example.myapplication;&#10;&#10;import android.content.Context;&#10;import android.net.Uri;&#10;import android.util.Log;&#10;&#10;import java.io.IOException;&#10;import java.io.InputStream;&#10;&#10;import okhttp3.MediaType;&#10;import okhttp3.OkHttpClient;&#10;import okhttp3.Request;&#10;import okhttp3.RequestBody;&#10;import okhttp3.Response;&#10;import okhttp3.internal.http2.StreamResetException;&#10;&#10;public class AzureUploader {&#10;    private static final String TAG = &quot;AzureUploader&quot;;&#10;    private final OkHttpClient client = new OkHttpClient();&#10;    private final Context context;&#10;    private final String sasUrl; // base container SAS URL (must end with container path)&#10;&#10;    public AzureUploader(Context context, String sasUrl) {&#10;        this.context = context;&#10;        this.sasUrl = sasUrl;&#10;    }&#10;&#10;    // Uploads a file stream to a specific blob path using PUT. Returns response message or throws IOException.&#10;    public String uploadBlob(String blobName, Uri fileUri) throws IOException {&#10;        // Construct full URL: sasUrl + &quot;/&quot; + blobName + &quot;?&quot; + SAS_QUERY (if sasUrl already includes query, ensure correct joining)&#10;        String url = sasUrl;&#10;        if (!url.endsWith(&quot;/&quot;)) url += &quot;/&quot;;&#10;        url += blobName;&#10;&#10;        // Read input stream&#10;        InputStream is = context.getContentResolver().openInputStream(fileUri);&#10;        if (is == null) throw new IOException(&quot;Unable to open input stream for URI: &quot; + fileUri);&#10;&#10;        RequestBody body = new InputStreamRequestBody(is, MediaType.get(&quot;video/mp4&quot;));&#10;&#10;        Request request = new Request.Builder()&#10;                .url(url)&#10;                .put(body)&#10;                .addHeader(&quot;x-ms-blob-type&quot;, &quot;BlockBlob&quot;)&#10;                .build();&#10;&#10;        try (Response response = client.newCall(request).execute()) {&#10;            if (!response.isSuccessful()) {&#10;                String msg = &quot;Upload failed: &quot; + response.code() + &quot; &quot; + response.message();&#10;                Log.e(TAG, msg);&#10;                throw new IOException(msg + &quot; - &quot; + (response.body() != null ? response.body().string() : &quot;&quot;));&#10;            }&#10;            return response.body() != null ? response.body().string() : &quot;OK&quot;;&#10;        }&#10;    }&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package com.example.myapplication;&#10;&#10;import android.content.Context;&#10;import android.net.Uri;&#10;import android.util.Log;&#10;&#10;import java.io.IOException;&#10;import java.io.InputStream;&#10;&#10;import okhttp3.MediaType;&#10;import okhttp3.OkHttpClient;&#10;import okhttp3.Request;&#10;import okhttp3.RequestBody;&#10;import okhttp3.Response;&#10;&#10;public class AzureUploader {&#10;    private static final String TAG = &quot;AzureUploader&quot;;&#10;    private final OkHttpClient client = new OkHttpClient();&#10;    private final Context context;&#10;    private final String sasUrl; // container SAS URL, may include query&#10;&#10;    public AzureUploader(Context context, String sasUrl) {&#10;        this.context = context;&#10;        this.sasUrl = sasUrl;&#10;    }&#10;&#10;    // Uploads a file stream to a specific blob path using PUT. Returns response message or throws IOException.&#10;    public String uploadBlob(String blobName, Uri fileUri) throws IOException {&#10;        // If sasUrl contains a query (SAS token), we need to insert the blob name before the query or append appropriately.&#10;        String url;&#10;        int q = sasUrl.indexOf('?');&#10;        if (q &gt;= 0) {&#10;            // sasUrl like https://account.blob.core.windows.net/container?sv=... -&gt; insert /blobName before ?&#10;            String before = sasUrl.substring(0, q);&#10;            String after = sasUrl.substring(q); // includes ?&#10;            if (!before.endsWith(&quot;/&quot;)) before += &quot;/&quot;;&#10;            url = before + blobName + after;&#10;        } else {&#10;            url = sasUrl;&#10;            if (!url.endsWith(&quot;/&quot;)) url += &quot;/&quot;;&#10;            url += blobName;&#10;        }&#10;&#10;        // Read input stream&#10;        InputStream is = context.getContentResolver().openInputStream(fileUri);&#10;        if (is == null) throw new IOException(&quot;Unable to open input stream for URI: &quot; + fileUri);&#10;&#10;        RequestBody body = new InputStreamRequestBody(is, MediaType.parse(&quot;video/mp4&quot;));&#10;&#10;        Request request = new Request.Builder()&#10;                .url(url)&#10;                .put(body)&#10;                .addHeader(&quot;x-ms-blob-type&quot;, &quot;BlockBlob&quot;)&#10;                .build();&#10;&#10;        try (Response response = client.newCall(request).execute()) {&#10;            if (!response.isSuccessful()) {&#10;                String msg = &quot;Upload failed: &quot; + response.code() + &quot; &quot; + response.message();&#10;                Log.e(TAG, msg);&#10;                throw new IOException(msg + &quot; - &quot; + (response.body() != null ? response.body().string() : &quot;&quot;));&#10;            }&#10;            return response.body() != null ? response.body().string() : &quot;OK&quot;;&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>